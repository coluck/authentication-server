<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>authentication-sever | docs</title>
</head>

<body>
  <h1 id="authentication-server">Authentication Server</h1>
  <p>The authentication-server is a node app that handles user registration, authentication &amp; authorization with <a
      href="https://jwt.io/introduction">JWT</a>.</p>
  <p>Here is the <a href="https://github.com/coluck/authentication-server">REPO</a>.</p>
  <p>Here is the <a href="https://auth-serv.herokuapp.com/">DEMO</a>.</p>
  <h3 id="how-it-works">How it works?</h3>
  <p>Registered users are stored in mongoDB and their password is hashed by bcrypt. When the user POSTs their
    credentials to the server, they recieve 2 Json Web Token (access &amp; refresh).</p>
  <p>On the client side user should set the authorization header(Bearer token) with access token. So user can be
    authorized by server with <a href="#middleware">middleware</a>. If the access token expired, renew the access token
    with refresh token by POSTing it to the &quot;/token&quot; endpoint.</p>
  <h3 id="usage">Usage</h3>
  <ol style="list-style-type: decimal">
    <li>
      <p>This server can be used as a standalone server. So the athentication system would be apart from the backend
        system. For authorization, JWT should be verified. JWT verification can be done in various programming
        languages. See: <a href="https://jwt.io/#libraries-io">libraries</a>.</p>
    </li>
    <li>
      <p>This server built with express.js. So it can be used on an existing express.js application.</p>
    </li>
  </ol>
  <hr />
  <h3 id="installation">Installation</h3>
  <pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">git</span> clone https://github.com/coluck/authentication-server.git
<span class="kw">cd</span> authentication-server
<span class="co"># replace .env.example with .env and customize it</span>
<span class="kw">npm</span> i
<span class="kw">npm</span> start</code></pre>
  <h3 id="api">API</h3>
  <table>
    <thead>
      <tr class="header">
        <th align="left">No</th>
        <th align="left">Method</th>
        <th align="left">Endpoint</th>
        <th align="left">Description</th>
      </tr>
    </thead>
    <tbody>
      <tr class="odd">
        <td align="left">#1</td>
        <td align="left"><code>POST</code></td>
        <td align="left"><code>/register</code></td>
        <td align="left">Creates a new user in MongoDB and returns it with status 201</td>
      </tr>
      <tr class="even">
        <td align="left">#2</td>
        <td align="left"><code>POST</code></td>
        <td align="left"><code>/login</code></td>
        <td align="left">Returns access &amp; refresh tokens if user credentials is valid</td>
      </tr>
      <tr class="odd">
        <td align="left">#3</td>
        <td align="left"><code>POST</code></td>
        <td align="left"><code>/token</code></td>
        <td align="left">Returns a new access token if refresh token in body is verified</td>
      </tr>
      <tr class="even">
        <td align="left">#4</td>
        <td align="left"><code>GET</code></td>
        <td align="left"><code>/validate</code></td>
        <td align="left">Returns user id if token in header is verified with <a href="#middleware">middleware</a></td>
      </tr>
    </tbody>
  </table>
  <table>
    <thead>
      <tr class="header">
        <th align="left">No</th>
        <th align="left">Request Body</th>
        <th align="left">Response Body</th>
      </tr>
    </thead>
    <tbody>
      <tr class="odd">
        <td align="left">#1</td>
        <td align="left">{ username, email, password }</td>
        <td align="left">{ username, email, createdAt }</td>
      </tr>
      <tr class="even">
        <td align="left">#2</td>
        <td align="left">{ email, password }</td>
        <td align="left">{ access_token, refresh_token }</td>
      </tr>
      <tr class="odd">
        <td align="left">#3</td>
        <td align="left">{ refresh_token }</td>
        <td align="left">{ access_token }</td>
      </tr>
      <tr class="even">
        <td align="left">#4</td>
        <td align="left">Authorization: Bearer <access_token>
        </td>
        <td align="left">User id that is logged in</td>
      </tr>
    </tbody>
  </table>
  <h3 id="configuration">Configuration</h3>
  <p>Configuration should made in the .env file, before run. .env.example file is below:</p>
  <pre class="env"><code>PORT=3000
MONGO_URL=mongodb://localhost:27017/&lt;db_name&gt;
ACCESS_TOKEN_EXPIRES_IN=5m
ACCESS_TOKEN_SECRET=c1ec3791140abfdddd...
REFRESH_TOKEN_EXIPRES_IN=1d
REFRESH_TOKEN_SECRET=2a4de696eb12838bc...</code></pre>
  <h3 id="scripts">Scripts</h3>
  <ol style="list-style-type: decimal">
    <li>
      <p>ACCESS_TOKEN_SECRET &amp; REFRESH_TOKEN_SECRET (both should be <strong>different</strong>) can be securely
        created with:</p>
      <pre
        class="sourceCode bash"><code class="sourceCode bash"><span class="kw">npm</span> run secret  <span class="co"># returns secret, paste it in .env</span></code></pre>
    </li>
    <li>
      <p>MongoDB connection can be tested with:</p>
      <pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">npm</span> run dbtest</code></pre>
    </li>
    <li>
      <p>Start authentication-server:</p>
      <pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">npm</span> start</code></pre>
    </li>
    <li>
      <p>Start development server with nodemon:</p>
      <pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">npm</span> run dev</code></pre>
    </li>
  </ol>
  <h3 id="project-structure">Project Structure</h3>
  <h3 id="user-interface">User Interface</h3>
  <p>Mini user interface is build with vue.js to show up what is going on. Available on root &quot;/&quot;. It can be
    removed from server.js file. <img
      src="https://user-images.githubusercontent.com/39749730/116825809-808cf700-ab99-11eb-8b30-98a5cfbc8f3e.png"
      alt="Screenshot_2021-05-02 authentication-sever User Interface" /> <img
      src="https://user-images.githubusercontent.com/39749730/116825812-8256ba80-ab99-11eb-9e98-9f9741344224.png"
      alt="Screenshot_2021-05-02 authentication-sever User Interface(1)" /></p>
  <h3 id="user-model">User Model</h3>
  <p>User Model is created with <a href="https://www.npmjs.com/package/mongoose">mongoose</a> in userModel.js. userModel
    = { username, email, password }</p>
  <h3 id="hash-password">Hash Password</h3>
  <p>Password is hashed with <a href="https://www.npmjs.com/package/bcryptjs">bcryptjs</a>. For performance see also: <a
      href="https://www.npmjs.com/package/bcrypt">bcrypt</a>.</p>
  <h3 id="validations">Validations</h3>
  <p>Implemented with <a href="https://joi.dev/api/?v=17.4.0">joi</a> in validation.js There are 2 validations(register
    and login) for request body.</p>
  <h3 id="middleware">Middleware</h3>
  <p>The isAuthenticated middleware verifies the jwt in authorization header. Simplified version of <a
      href="https://www.npmjs.com/package/express-jwt">express-jwt</a>. Used in /validate endpoint for testing purposes.
  </p>
  <h3 id="logger">Logger</h3>
  <p>Logging made with <a href="https://www.npmjs.com/package/morgan">morgan</a>. The formats is &quot;tiny&quot;. In
    server.js file it can be customized.</p>
  <h3 id="todos">Todos</h3>
  <ul>
    <li>Refresh tokens can be saved in storage like redis or mongoDB</li>
    <li>Login or Register limitation by ip address</li>
    <li>Add JWT claims like iss, sub, aud...</li>
    <li>Email verification</li>
    <li>Login with username instead of email</li>
  </ul>
</body>

</html>